<!--
GitHub Pages bootstrap for Lightning Out 2.0 (GA) to render an LWC directly, without Aura and without Experience Cloud.
Replace the placeholders:
  - ORG_DOMAIN: your Enhanced Domain that serves lightning.out.js (e.g., https://mydomain.my.salesforce.com)
  - COMPONENT_NAME: the LWC to mount ("c/ghPublicDemo")
Security prerequisites in Salesforce Setup (org-side):
  1) CORS Allowed Origins: https://<username>.github.io and/or https://<username>.github.io/<repo>
  2) CSP Trusted Sites (script): same as above
  3) If your org has specific Lightning Out allowed origins control, add the GitHub Pages origin there as well
Note: This POC renders a static UI LWC. Do not expose sensitive data. 
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lightning Out 2.0 — LWC on GitHub Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 2rem; background: #f4f6f9; }
    .card { background: #fff; border-radius: 8px; padding: 1.25rem 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .title { margin: 0 0 .5rem; font-size: 1.25rem; }
    .subtitle { margin: 0 0 1rem; color: #555; }
    #status { margin-top: 1rem; color: #666; font-size: 0.9rem; white-space: pre-wrap; }
    #container { margin-top: 1rem; }
    code { background: #f0f0f0; padding: .15rem .35rem; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="title">Lightning Out 2.0 — LWC on GitHub Pages</h1>
    <p class="subtitle">Rendering <code>c/ghPublicDemo</code> from your Salesforce org into this static page.</p>
    <div id="status">Initializing…</div>
    <div id="container"></div>
  </div>

  <!-- Replace ORG_DOMAIN with your Enhanced Domain host (example: https://mydomain.my.salesforce.com) -->
  <script src="https://creative-hawk-1ofvq9-dev-ed.trailblaze.my.salesforce.com/lightning/lightning.out.js"></script>
  <script>
    (function () {
      const ORG_DOMAIN = 'https://creative-hawk-1ofvq9-dev-ed.trailblaze.my.salesforce.com'; // REQUIRED: replace with your org domain
      const COMPONENT_NAME = 'c/ghPublicDemo'; // The LWC we created in this repo
      const TARGET_EL_ID = 'container';

      const statusEl = document.getElementById('status');
      function log(msg) {
        console.log('[LO2.0 GH]', msg);
        statusEl.textContent = String(statusEl.textContent || '') + (statusEl.textContent ? '\n' : '') + msg;
      }
      function fail(err) {
        console.error('[LO2.0 GH] ERROR', err);
        log('ERROR: ' + (err && err.message ? err.message : JSON.stringify(err)));
        log('Hints:\n- Verify ORG_DOMAIN is correct and Enhanced Domains are in use\n- Add this GitHub Pages origin to CORS and CSP Trusted Sites in Salesforce Setup\n- Check the browser console for CORS/CSP or handshake errors');
      }

      // Guard if lightning.out.js failed to load
      if (!window.$Lightning) {
        fail('lightning.out.js did not load. Verify ORG_DOMAIN and that /lightning/lightning.out.js is accessible.');
        return;
      }

      // Lightning Out 2.0 direct LWC bootstrap.
      // GA API naming may vary by release; primary contract is that LO 2.0 can mount LWC without Aura.
      // We attempt a robust pattern: if useLWC exists, prefer it; otherwise fallback to createComponent with LWC syntax (as enabled by LO 2.0).
      function mountLwc() {
        try {
          const container = document.getElementById(TARGET_EL_ID);
          if (!container) {
            fail('Target container not found: #' + TARGET_EL_ID);
            return;
          }

          // Preferred: direct LO 2.0 LWC entrypoint when present
          if (typeof $Lightning.useLWC === 'function') {
            log('Using Lightning Out 2.0: $Lightning.useLWC()');
            $Lightning.useLWC(
              ORG_DOMAIN,
              function initDone() {
                log('Lightning runtime initialized.');
                $Lightning.createComponent(
                  COMPONENT_NAME,
                  {},
                  TARGET_EL_ID,
                  function created(cmp) {
                    log('LWC mounted successfully.');
                  }
                );
              },
              function initErr(e) {
                fail(e || 'Unknown error during useLWC init');
              }
            );
            return;
          }

          // Fallback: LO 2.0 may allow LWC via traditional $Lightning.use against org domain
          if (typeof $Lightning.use === 'function') {
            log('Using fallback: $Lightning.use() with org domain.');
            $Lightning.use(
              ORG_DOMAIN,
              function initDone() {
                log('Lightning runtime initialized (fallback).');
                $Lightning.createComponent(
                  COMPONENT_NAME,
                  {},
                  TARGET_EL_ID,
                  function created(cmp) {
                    log('LWC mounted successfully (fallback).');
                  }
                );
              },
              function initErr(e) {
                fail(e || 'Unknown error during fallback init');
              }
            );
            return;
          }

          fail('No compatible Lightning Out 2.0 bootstrap function found on $Lightning.');
        } catch (e) {
          fail(e);
        }
      }

      // Start
      log('Loading Lightning Out 2.0 runtime from ' + ORG_DOMAIN + ' …');
      // Some orgs require a small delay to ensure the script is parsed; also permits CSP console messages to appear first.
      setTimeout(mountLwc, 0);
    })();
  </script>
</body>
</html>
